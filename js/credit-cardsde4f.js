/*
 This code is UNLICENSED and is not free to use. All rights reserved by Ratehub.ca
*/
!function(e){function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}var r={};n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:t})},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=0)}([function(module,exports,__webpack_require__){(function(global){function calcRewards(usage,
cardRules,pointSystems){function initializeSpending(){return{bills:12*usage.monthly_bills,entertainment:12*usage.monthly_entertainment,gas:12*usage.monthly_gas,groceries:12*usage.monthly_groceries,restaurants:12*usage.monthly_restaurants,travel:12*usage.monthly_travel,pharmacy:12*usage.monthly_pharmacy,other:12*usage.monthly_other}}function getRemainingAnnualSpending(e){return Object.keys(e).reduce(function(n,r){return n+e[r]},0)}function addBonusTo(e,n,r,t){if(n&&t){var a={rate:r,categories:{}};
Object.keys(n).forEach(function(e){var r=Math.min(n[e],t[e]);t[e]-=r,a.categories[e]={spentPerYear:r}});var i=formatSpendingBonus(a);i.totalRewards>0&&e.push(i)}}function formatSpendingBonus(e){var n=0,r=0;return Object.keys(e.categories).forEach(function(t){var a=e.categories[t];n+=a.rewards=a.spentPerYear*e.rate,creditCard.isCashback?r+=a.cashValue=a.rewards:r+=a.cashValue=toCash(usage,a.rewards,creditCard.pointSystem)}),e.totalRewards=n,e.totalCashValue=r,e.metadata={},rewardsRule.bonusRate&&(e.metadata.bonusRate=
rewardsRule.bonusRate),rewardsRule.tieredRate&&(e.metadata.tieredRate=rewardsRule.tieredRate),e}function insertFirstYearSpendingBonus(e,n,r,t){addBonusTo(e.firstYearRewards,n,r,t)}function insertSubsequentYearSpendingBonus(e,n,r,t){addBonusTo(e.subsequentYearRewards,n,r,t)}function addWelcomeSpendingBonus(e,n,r){"string"==typeof r&&(r=run(r)),e.welcomeBonus.welcome_spending[n]?e.welcomeBonus.welcome_spending[n]+=r:e.welcomeBonus.welcome_spending[n]=r}function addWelcomeSignupBonus(e,n,r){"string"==
typeof r&&(r=run(r)),e.welcomeBonus.welcome_signup[n]?e.welcomeBonus.welcome_signup[n]+=r:e.welcomeBonus.welcome_signup[n]=r}function addAnniversaryBonus(e,n,r){"string"==typeof r&&(r=run(r)),e.anniversary[n]?e.anniversary[n]+=r:e.anniversary[n]=r}function addMonthlyBonus(e,n,r){"string"==typeof r&&(r=run(r)),e.monthly[n]?e.monthly[n]+=r:e.monthly[n]=r}function run(fnString){return eval("("+fnString+")(creditCard, usage)")}for(var creditCard,key,results=[],unmodifiedSpending=initializeSpending(),
i=0;i<cardRules.length;i++){creditCard=toCreditCard(cardRules[i]);for(var remainingFirstYearSpending=Object.assign({},unmodifiedSpending),remainingSubsequentYearSpending=Object.assign({},unmodifiedSpending),j=0;j<creditCard.rewards_rules.length;j++){var rewardsRule=creditCard.rewards_rules[j];if(!rewardsRule.condition||run(rewardsRule.condition)){if(rewardsRule.rate&&getRemainingAnnualSpending(remainingFirstYearSpending)>0)if(rewardsRule.tieredRate||rewardsRule.bonusRate){var months=rewardsRule.bonusRate&&
rewardsRule.bonusRate.months?rewardsRule.bonusRate.months:12,termCategorySpending=0,monthlyCategorySpending=0,applicableCategories=rewardsRule.categories;applicableCategories.forEach(function(e){monthlyCategorySpending+=usage["monthly_"+e]}),termCategorySpending+=monthlyCategorySpending*months;var maximumSpending=0;if(rewardsRule.tieredRate){var upperLimit=rewardsRule.tieredRate.to,lowerLimit=rewardsRule.tieredRate.from;maximumSpending=upperLimit?Math.min(upperLimit,termCategorySpending):termCategorySpending,
lowerLimit&&(maximumSpending-=Math.min(lowerLimit,maximumSpending))}else rewardsRule.bonusRate&&(maximumSpending=rewardsRule.bonusRate.maximumAmount?Math.min(termCategorySpending,rewardsRule.bonusRate.maximumAmount):termCategorySpending);var spentThisMonth=0,spentDuringTerm=0,k=0,categorySpending={};for(k=0;k<months;k++)applicableCategories.forEach(function(e){spentThisMonth=Math.min(usage["monthly_"+e],maximumSpending-spentDuringTerm),spentThisMonth=spentThisMonth*months<remainingFirstYearSpending[e]?
spentThisMonth:remainingFirstYearSpending[e]/months,spentDuringTerm+=spentThisMonth,categorySpending[e]=(categorySpending[e]||0)+spentThisMonth});if(insertFirstYearSpendingBonus(creditCard,categorySpending,rewardsRule.rate,remainingFirstYearSpending),rewardsRule.tieredRate||rewardsRule.bonusRate&&rewardsRule.bonusRate.recurring){for(spentDuringTerm=0,categorySpending={},k=0;k<months;k++)applicableCategories.forEach(function(e){spentThisMonth=Math.min(usage["monthly_"+e],maximumSpending-spentDuringTerm),
spentThisMonth=spentThisMonth*months<remainingSubsequentYearSpending[e]?spentThisMonth:remainingSubsequentYearSpending[e]/months,spentDuringTerm+=spentThisMonth,categorySpending[e]=(categorySpending[e]||0)+spentThisMonth});insertSubsequentYearSpendingBonus(creditCard,categorySpending,rewardsRule.rate,remainingSubsequentYearSpending)}}else{var categorySpending={};rewardsRule.categories.forEach(function(e){categorySpending[e]=12*usage["monthly_"+e]}),insertFirstYearSpendingBonus(creditCard,categorySpending,
rewardsRule.rate,remainingFirstYearSpending),insertSubsequentYearSpendingBonus(creditCard,categorySpending,rewardsRule.rate,remainingSubsequentYearSpending)}if(rewardsRule.welcomeSpending)for(var pointSystem in rewardsRule.welcomeSpending)addWelcomeSpendingBonus(creditCard,pointSystem,rewardsRule.welcomeSpending[pointSystem]);if(rewardsRule.welcomeSignup)for(var pointSystem in rewardsRule.welcomeSignup)addWelcomeSignupBonus(creditCard,pointSystem,rewardsRule.welcomeSignup[pointSystem]);if(rewardsRule.anniversary)for(var pointSystem in rewardsRule.anniversary)addAnniversaryBonus(creditCard,
pointSystem,rewardsRule.anniversary[pointSystem]);if(rewardsRule.monthly)for(var pointSystem in rewardsRule.monthly)addMonthlyBonus(creditCard,pointSystem,rewardsRule.monthly[pointSystem]);rewardsRule.run&&run(rewardsRule.run)}}formatRewardValues(usage,creditCard,pointSystems),parseGiftCards([creditCard]),results.push(creditCard)}return results}function parseGiftCards(e){for(var n=0;n<e.length;n++)if(e[n].gift_cards&&!Array.isArray(e[n].gift_cards)){var r=null;for(var t in e[n].gift_cards)e[n].gift_cards.hasOwnProperty(t)&&
e[n].gift_cards[t].amount>0&&(r=t);e[n].selectedPromo=e[n].gift_cards[r],e[n].netFirstYearValue+=e[n].gift_cards[r].amount}}function toCash(e,n,r){return n*getRedemptionRate(e,r)}function toCreditCard(e){var n=Object.assign({},e);if(n.anniversary={},n.benefits=n.benefits||{},n.card_category=[],n.eligibility=n.eligibility||{},n.fees={firstYear:0,subsequentYears:0},n.firstYearRewards=[],n.monthly={},n.monthlyBonus={points:0,value:0,valuePerPt:0},n.netFirstYearValue=0,n.netSubsequentYearValue=0,n.subsequentYearRewards=
[],n.welcomeBonus={welcome_signup:{},welcome_spending:{}},!e||0==e.length)return n;for(var r=0;r<e.card_category.length;r++)switch(e.card_category[r]){case "Rewards":n.isRewards=!0;break;case "Balance transfer":n.isBalanceTransfer=!0;break;case "Secured":n.isSecured=!0;break;case "Low interest":n.isLowInterest=!0}return n.eligibility.deposit_options&&(n.eligibility.deposit_options=n.eligibility.deposit_options.split(",")),n.point_system&&(n.pointSystem=n.point_system,delete n.point_system),n.isCashback=
n.pointSystem?"%"===n.pointSystem.metric:null,n.fees={firstYear:e.first_year_fee,subsequentYears:e.fee},n}function pointsToCash(e,n,r){var t=0;if(!n||0==n.length)return t;for(var a in n)if(r[a])t+=toCash(e,n[a],r[a]);else for(var i in n[a])t+=toCash(e,n[a][i],r[i]);return t}function sumPoints(e,n){var r=0;if(!e)return r;for(var t in e)if(n[t])r+=e[t];else for(var a in e[t])r+=e[t];return r}function getRedemptionRate(e,n){if(null==n)return 0;var r=[],t=n.point_to_dollar||{};return e.redeem_hotels&&
r.push(t.hotels||0),e.redeem_flights&&r.push(t.flights||0),e.redeem_giftcards&&r.push(t.giftcards||0),e.redeem_merchandise&&r.push(t.merchandise||0),r.push(n.cash_value),Math.max.apply(null,r)}function formatRewardValues(e,n,r){n.welcomeSignup=getMiscBonusValues(e,n.welcomeBonus,"welcome_signup",r),n.welcomeSpending=getMiscBonusValues(e,n.welcomeBonus,"welcome_spending",r),n.monthlyBonus=getMiscBonusValues(e,n,"monthly",r),n.anniversary=getMiscBonusValues(e,n,"anniversary",r),n.netFirstYearValue=
getNetFirstYearValue(n),n.netSubsequentYearValue=getNetSubsequentYearValue(n)}function getMiscBonusValues(e,n,r,t){var a={points:0,value:0,valuePerPt:0};if(n[r])for(var i in n[r])t[i]?(t[i].metric&&(a.points+=sumPoints(n[r],t)),a.value=pointsToCash(e,n[r],t)):console.log('Point system "'+i+'" is not defined, but was assigned as a "'+r+'"');return a.valuePerPt=0!==a.points?a.value/a.points:0,a}function getSpendingBonusSum(e){var n=0;return e.forEach(function(e){n+=e.totalCashValue}),Math.floor(n)}
function getNetFirstYearValue(e){return Math.floor(e.welcomeSpending.value+e.welcomeSignup.value+12*e.monthlyBonus.value-e.fees.firstYear+getSpendingBonusSum(e.firstYearRewards))}function getNetSubsequentYearValue(e){return Math.floor(e.anniversary.value-e.fees.subsequentYears+12*e.monthlyBonus.value+getSpendingBonusSum(e.subsequentYearRewards))}function getUsage(e,n,r,t){var a={};return a.monthly_groceries=e.groceries,a.monthly_gas=e.gas,a.monthly_restaurants=e.restaurants,a.monthly_bills=e.bills,
a.monthly_travel=e.travel,a.monthly_entertainment=e.entertainment,a.monthly_pharmacy=e.pharmacy,a.monthly_other=e.other,a.monthly_total=a.monthly_groceries+a.monthly_gas+a.monthly_restaurants+a.monthly_bills+a.monthly_travel+a.monthly_entertainment+a.monthly_pharmacy+a.monthly_other,a.income=n,a.redeem_cash="All"===r||"Cash back"===r,a.redeem_giftcards="All"===r||"Store credit"===r,a.redeem_merchandise="All"===r||"Store credit"===r,a.redeem_flights="All"===r||"Travel"===r,a.redeem_hotels="All"===
r||"Travel"===r,a.nofee=t,a}module.exports={calcRewards:calcRewards,parseGiftCards:parseGiftCards,toCreditCard:toCreditCard,formatRewardValues:formatRewardValues,getSpendingBonusSum:getSpendingBonusSum,getNetFirstYearValue:getNetFirstYearValue,getNetSubsequentYearValue:getNetSubsequentYearValue,getUsage:getUsage},void 0!==global&&Object.assign(global,module.exports)}).call(exports,__webpack_require__(1))},function(e,n){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e$0){"object"==
typeof window&&(r=window)}e.exports=r}]);
